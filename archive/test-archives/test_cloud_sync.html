<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test I-9 Cloud Sync</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>I-9 Cloud Sync Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Save I-9 Section 1 to Cloud</h2>
        <button onclick="testI9Section1CloudSync()">Run Test</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Save I-9 Section 2 Documents to Cloud</h2>
        <button onclick="testI9Section2CloudSync()">Run Test</button>
        <div id="test2-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Verify Cloud Data Retrieval</h2>
        <button onclick="testCloudRetrieval()">Run Test</button>
        <div id="test3-result"></div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000';
        const TEST_EMPLOYEE_ID = 'test-cloud-' + Date.now();

        async function testI9Section1CloudSync() {
            const resultDiv = document.getElementById('test1-result');
            resultDiv.innerHTML = '<h3>Testing I-9 Section 1 Cloud Sync...</h3>';
            
            const testData = {
                formData: {
                    last_name: 'CloudTest',
                    first_name: 'John',
                    middle_initial: 'C',
                    date_of_birth: '1990-01-01',
                    ssn: '123-45-6789',
                    email: 'cloudtest@example.com',
                    phone: '555-1234',
                    address: '123 Cloud St',
                    city: 'CloudCity',
                    state: 'CC',
                    zip_code: '12345',
                    citizenship_status: 'citizen'
                },
                signed: true,
                signatureData: 'data:image/png;base64,TEST_SIGNATURE',
                completedAt: new Date().toISOString()
            };
            
            try {
                // Test saving to cloud
                const response = await fetch(`${API_URL}/api/onboarding/${TEST_EMPLOYEE_ID}/i9-section1`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    resultDiv.innerHTML += '<p class="success">✓ I-9 Section 1 saved to cloud</p>';
                    resultDiv.innerHTML += '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                    
                    // Store in session storage to simulate frontend behavior
                    sessionStorage.setItem('onboarding_i9-section1_data', JSON.stringify(testData));
                    resultDiv.innerHTML += '<p class="success">✓ Data also saved to session storage</p>';
                } else {
                    const error = await response.text();
                    resultDiv.innerHTML += '<p class="error">✗ Failed to save to cloud: ' + error + '</p>';
                }
            } catch (error) {
                resultDiv.innerHTML += '<p class="error">✗ Error: ' + error.message + '</p>';
            }
        }

        async function testI9Section2CloudSync() {
            const resultDiv = document.getElementById('test2-result');
            resultDiv.innerHTML = '<h3>Testing I-9 Section 2 Cloud Sync...</h3>';
            
            const testData = {
                documentSelection: 'list_a',
                uploadedDocuments: [
                    {
                        id: 'doc_' + Date.now(),
                        type: 'list_a',
                        documentType: 'US Passport',
                        fileName: 'passport.pdf',
                        fileSize: 1048576,
                        uploadedAt: new Date().toISOString(),
                        ocrData: {
                            document_number: 'P123456789',
                            expiry_date: '2030-01-01'
                        }
                    }
                ],
                verificationComplete: true,
                completedAt: new Date().toISOString()
            };
            
            try {
                // Test saving to cloud
                const response = await fetch(`${API_URL}/api/onboarding/${TEST_EMPLOYEE_ID}/i9-section2`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    resultDiv.innerHTML += '<p class="success">✓ I-9 Section 2 documents saved to cloud</p>';
                    resultDiv.innerHTML += '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                    
                    // Store in session storage
                    sessionStorage.setItem('onboarding_i9-section2_data', JSON.stringify(testData));
                    resultDiv.innerHTML += '<p class="success">✓ Documents also saved to session storage</p>';
                } else {
                    const error = await response.text();
                    resultDiv.innerHTML += '<p class="error">✗ Failed to save to cloud: ' + error + '</p>';
                }
            } catch (error) {
                resultDiv.innerHTML += '<p class="error">✗ Error: ' + error.message + '</p>';
            }
        }

        async function testCloudRetrieval() {
            const resultDiv = document.getElementById('test3-result');
            resultDiv.innerHTML = '<h3>Testing Cloud Data Retrieval...</h3>';
            
            try {
                // Test retrieving I-9 Section 1
                const response1 = await fetch(`${API_URL}/api/onboarding/${TEST_EMPLOYEE_ID}/i9-section1`);
                if (response1.ok) {
                    const data1 = await response1.json();
                    resultDiv.innerHTML += '<p class="success">✓ Retrieved I-9 Section 1 from cloud</p>';
                    resultDiv.innerHTML += '<h4>I-9 Section 1 Data:</h4>';
                    resultDiv.innerHTML += '<pre>' + JSON.stringify(data1, null, 2) + '</pre>';
                } else {
                    resultDiv.innerHTML += '<p class="warning">⚠ No I-9 Section 1 data found (run Test 1 first)</p>';
                }
                
                // Clear session storage to simulate new session
                sessionStorage.clear();
                resultDiv.innerHTML += '<p>Session storage cleared - simulating new browser session</p>';
                
                // Verify data can still be retrieved from cloud
                const response2 = await fetch(`${API_URL}/api/onboarding/${TEST_EMPLOYEE_ID}/i9-section1`);
                if (response2.ok) {
                    resultDiv.innerHTML += '<p class="success">✓ Data persists in cloud after session clear!</p>';
                } else {
                    resultDiv.innerHTML += '<p class="error">✗ Data lost after session clear</p>';
                }
                
            } catch (error) {
                resultDiv.innerHTML += '<p class="error">✗ Error: ' + error.message + '</p>';
            }
        }
    </script>
</body>
</html>