<!DOCTYPE html>
<html>
<head>
    <title>Test Backend PDF Generation</title>
</head>
<body>
    <h1>Direct Backend PDF Test</h1>
    <p>Click the button below to test PDF generation directly:</p>

    <button id="testBtn">Test PDF Generation</button>
    <div id="results"></div>

    <script>
        document.getElementById('testBtn').addEventListener('click', async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing...</p>';

            try {
                // Test data that should work
                const testData = {
                    employee_data: {
                        firstName: "John",
                        lastName: "Doe",
                        email: "john.doe@example.com",
                        ssn: "123-45-6789",
                        paymentMethod: "direct_deposit",
                        depositType: "full",
                        primaryAccount: {
                            bankName: "Chase Bank",
                            routingNumber: "021000021",
                            accountNumber: "1234567890",
                            accountType: "checking",
                            depositAmount: "",
                            percentage: 100
                        },
                        additionalAccounts: [],
                        voidedCheckUploaded: false,
                        bankLetterUploaded: false,
                        totalPercentage: 100,
                        authorizeDeposit: true,
                        employeeSignature: "",
                        dateOfAuth: "2025-01-27"
                    }
                };

                console.log('Sending test data:', testData);

                const response = await fetch('/api/onboarding/test-employee/direct-deposit/generate-pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                console.log('Response status:', response.status);

                if (response.ok) {
                    const result = await response.json();
                    console.log('✅ Success:', result);

                    if (result.data?.pdf) {
                        // Decode and analyze PDF
                        const pdfBytes = Uint8Array.from(atob(result.data.pdf), c => c.charCodeAt(0));
                        const pdfText = new TextDecoder().decode(pdfBytes);

                        // Check for filled data
                        const hasName = pdfText.includes('John') || pdfText.includes('Doe');
                        const hasSSN = pdfText.includes('123-45') || pdfText.includes('6789');
                        const hasBank = pdfText.includes('Chase');

                        resultsDiv.innerHTML = `
                            <h2>✅ PDF Generated Successfully!</h2>
                            <p><strong>PDF Size:</strong> ${pdfBytes.length} bytes</p>
                            <p><strong>Content Check:</strong></p>
                            <ul>
                                <li>Name data: ${hasName ? '✅ FOUND' : '❌ MISSING'}</li>
                                <li>SSN data: ${hasSSN ? '✅ FOUND' : '❌ MISSING'}</li>
                                <li>Bank data: ${hasBank ? '✅ FOUND' : '❌ MISSING'}</li>
                            </ul>
                            <p><strong>Raw PDF Text Preview:</strong></p>
                            <textarea rows="10" cols="80">${pdfText.substring(0, 1000)}...</textarea>
                        `;

                        // Auto-download
                        const blob = new Blob([pdfBytes], {type: 'application/pdf'});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'backend-test.pdf';
                        a.click();
                        URL.revokeObjectURL(url);

                        resultsDiv.innerHTML += '<p><strong>✅ PDF Downloaded!</strong></p>';

                    } else {
                        resultsDiv.innerHTML = '<p>❌ No PDF data in response</p>';
                    }
                } else {
                    const errorText = await response.text();
                    resultsDiv.innerHTML = `<p>❌ Error: ${response.status}</p><pre>${errorText}</pre>`;
                }

            } catch (error) {
                resultsDiv.innerHTML = `<p>❌ Network Error: ${error.message}</p>`;
                console.error(error);
            }
        });
    </script>
</body>
</html>
