/opt/homebrew/lib/python3.13/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
WARNING:app.supabase_service_enhanced:SUPABASE_SERVICE_KEY not set, using anon key for admin operations
INFO:app.supabase_service_enhanced:✅ Enhanced Supabase service initialized
/Users/gouthamvemula/onbclaude/onbdev/hotel-onboarding-backend/app/main_enhanced.py:55: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("startup")
INFO:     Started server process [8705]
INFO:     Waiting for application startup.
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A "HTTP/2 200 OK"
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&email=eq.hr.frontend.test%40hotel.com "HTTP/2 200 OK"
✅ Supabase-enabled backend started successfully
INFO:     127.0.0.1:60502 - "POST /auth/login HTTP/1.1" 401 Unauthorized
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&email=eq.frontend.test%40hotel.com "HTTP/2 200 OK"
INFO:httpx:HTTP Request: POST https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users "HTTP/2 201 Created"
WARNING:passlib.handlers.bcrypt:(trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.13/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
INFO:     127.0.0.1:60658 - "POST /secret/create-hr?email=frontend.test@hotel.com&password=TestPass123&secret_key=hotel-admin-2025 HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&email=eq.hr.frontend.test%40hotel.com "HTTP/2 200 OK"
INFO:     127.0.0.1:62496 - "POST /auth/login HTTP/1.1" 401 Unauthorized
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&email=eq.hr.test.final%40hotel.com "HTTP/2 200 OK"
INFO:httpx:HTTP Request: POST https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users "HTTP/2 201 Created"
INFO:     127.0.0.1:62543 - "POST /secret/create-hr?email=hr.test.final@hotel.com&password=FinalTest123&secret_key=hotel-admin-2025 HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&email=eq.hr.test.final%40hotel.com "HTTP/2 200 OK"
INFO:     127.0.0.1:62590 - "POST /auth/login HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&email=eq.hr.test.final%40hotel.com "HTTP/2 200 OK"
INFO:     127.0.0.1:62906 - "POST /secret/create-hr?email=hr.test.final%40hotel.com&password=FinalTest123&secret_key=hotel-admin-2025 HTTP/1.1" 400 Bad Request
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&email=eq.hr.test.final%40hotel.com "HTTP/2 200 OK"
INFO:     127.0.0.1:62909 - "POST /auth/login HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/properties?select=id&is_active=eq.True "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=id&role=eq.manager&is_active=eq.True "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/employees?select=id&employment_status=eq.active "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/job_applications?select=id&status=eq.pending "HTTP/2 200 OK"
INFO:     127.0.0.1:62915 - "GET /hr/dashboard-stats HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/properties?select=%2A "HTTP/2 200 OK"
INFO:     127.0.0.1:62917 - "GET /hr/properties HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: POST https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/properties "HTTP/2 401 Unauthorized"
WARNING:app.supabase_service_enhanced:Admin client failed: {'message': 'new row violates row-level security policy for table "properties"', 'code': '42501', 'hint': None, 'details': None}, trying alternative approach
INFO:httpx:HTTP Request: POST https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/rpc/create_property_bypass_rls "HTTP/2 404 Not Found"
WARNING:app.supabase_service_enhanced:RPC method failed: {'message': 'Could not find the function public.create_property_bypass_rls(property_data) in the schema cache', 'code': 'PGRST202', 'hint': None, 'details': 'Searched for the function public.create_property_bypass_rls with parameter property_data or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.'}, trying direct insert
INFO:httpx:HTTP Request: POST https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/properties "HTTP/2 401 Unauthorized"
ERROR:app.supabase_service_enhanced:RLS policy blocking property creation: {'message': 'new row violates row-level security policy for table "properties"', 'code': '42501', 'hint': None, 'details': None}
WARNING:app.supabase_service_enhanced:Bypassing RLS error for development - property may not be actually created
INFO:     127.0.0.1:62919 - "POST /hr/properties HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&role=eq.manager "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/property_managers?select=properties%28%2A%29&manager_id=eq.24159b27-c40e-4f47-8403-de9916ab3ead "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/property_managers?select=properties%28%2A%29&manager_id=eq.645cf5b6-9fbb-487f-85eb-0473845ca9ae "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/property_managers?select=properties%28%2A%29&manager_id=eq.b0695348-c475-414a-b1b9-5733055bad75 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/property_managers?select=properties%28%2A%29&manager_id=eq.ea67171f-18b5-453a-bba8-ab2f39fb26c0 "HTTP/2 200 OK"
INFO:     127.0.0.1:62925 - "GET /hr/managers HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.24159b27-c40e-4f47-8403-de9916ab3ead&role=eq.manager "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/property_managers?select=properties%28%2A%29&manager_id=eq.24159b27-c40e-4f47-8403-de9916ab3ead "HTTP/2 200 OK"
INFO:     127.0.0.1:62927 - "GET /hr/managers/24159b27-c40e-4f47-8403-de9916ab3ead HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.24159b27-c40e-4f47-8403-de9916ab3ead&role=eq.manager "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/property_managers?select=properties%28%2A%29&manager_id=eq.24159b27-c40e-4f47-8403-de9916ab3ead "HTTP/2 200 OK"
INFO:     127.0.0.1:62929 - "GET /hr/managers/24159b27-c40e-4f47-8403-de9916ab3ead/performance HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/job_applications?select=%2A "HTTP/2 200 OK"
INFO:     127.0.0.1:62935 - "GET /hr/applications HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: PATCH https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/job_applications?id=eq.c0a3a631-5eb3-4219-94d7-ebab9eabcab7 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: PATCH https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/job_applications?id=eq.f7014bd1-a144-45f0-ac1d-bb20794a5683 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: POST https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/application_status_history "HTTP/2 400 Bad Request"
ERROR:app.supabase_service_enhanced:Failed to add application status history: {'message': "Could not find the 'previous_status' column of 'application_status_history' in the schema cache", 'code': 'PGRST204', 'hint': None, 'details': None}
INFO:httpx:HTTP Request: POST https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/application_status_history "HTTP/2 400 Bad Request"
ERROR:app.supabase_service_enhanced:Failed to add application status history: {'message': "Could not find the 'previous_status' column of 'application_status_history' in the schema cache", 'code': 'PGRST204', 'hint': None, 'details': None}
INFO:     127.0.0.1:62937 - "POST /hr/applications/bulk-status-update HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/job_applications?select=id&applicant_email=eq.test.duplicate%40example.com&property_id=eq.f61d8f46-a858-464f-a1a5-1dc0668594cd&position=eq.Front+Desk+Clerk&status=in.%28pending%2Capproved%2Chired%29 "HTTP/2 400 Bad Request"
ERROR:app.supabase_service_enhanced:Failed to check duplicate application: {'message': 'column job_applications.applicant_email does not exist', 'code': '42703', 'hint': None, 'details': None}
INFO:     127.0.0.1:62939 - "POST /applications/check-duplicate HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/employees?select=%2A&id=eq.search "HTTP/2 400 Bad Request"
ERROR:app.supabase_service_enhanced:Error getting employee by ID: {'message': 'invalid input syntax for type uuid: "search"', 'code': '22P02', 'hint': None, 'details': None}
INFO:     127.0.0.1:62941 - "GET /hr/employees/search?search_query=test HTTP/1.1" 404 Not Found
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/employees?select=%2A&id=eq.stats "HTTP/2 400 Bad Request"
ERROR:app.supabase_service_enhanced:Error getting employee by ID: {'message': 'invalid input syntax for type uuid: "stats"', 'code': '22P02', 'hint': None, 'details': None}
INFO:     127.0.0.1:62943 - "GET /hr/employees/stats HTTP/1.1" 404 Not Found
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/applications?select=%2A&status=eq.talent_pool "HTTP/2 404 Not Found"
INFO:     127.0.0.1:62945 - "GET /hr/applications/talent-pool HTTP/1.1" 500 Internal Server Error
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/users?select=%2A&id=eq.73675d5e-3a0e-4c5b-a9f4-e5eb6724da67 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://onmjxtyamdpkhnflwwmj.supabase.co/rest/v1/applications?select=%2A&status=eq.talent_pool "HTTP/2 404 Not Found"
INFO:     127.0.0.1:65361 - "GET /hr/applications/talent-pool HTTP/1.1" 500 Internal Server Error
